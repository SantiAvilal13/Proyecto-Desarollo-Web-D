<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title th:text="'Detalles de ' + ${barco.nombre}">Detalles del Barco</title>
</head>
<body>
    <main>
        <div class="container mt-4">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <!-- Mensajes de éxito/error -->
                    <div th:if="${successMessage}" class="alert alert-success alert-dismissible fade show" role="alert">
                        <i class="fas fa-check-circle me-2"></i>
                        <span th:text="${successMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>
                    
                    <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                        <i class="fas fa-exclamation-circle me-2"></i>
                        <span th:text="${errorMessage}"></span>
                        <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                    </div>

                    <div class="card">
                        <div class="card-header d-flex justify-content-between align-items-center">
                            <h3 class="card-title mb-0">
                                <i class="fas fa-ship me-2"></i>
                                Detalles del Barco
                            </h3>
                            <div class="d-flex gap-2">
                                <a th:href="@{'/barcos/' + ${barco.id} + '/edit'}" class="btn btn-warning btn-sm">
                                    <i class="fas fa-edit me-1"></i>Editar
                                </a>
                                <button type="button" class="btn btn-danger btn-sm" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                    <i class="fas fa-trash me-1"></i>Eliminar
                                </button>
                            </div>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <!-- Información básica -->
                                <div class="col-md-6">
                                    <h5 class="text-primary mb-3">
                                        <i class="fas fa-info-circle me-2"></i>Información Básica
                                    </h5>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold text-muted">ID:</label>
                                        <p class="mb-1">
                                            <span class="badge bg-secondary" th:text="${barco.id}"></span>
                                        </p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold text-muted">Nombre del Barco:</label>
                                        <p class="mb-1 fs-5 fw-bold" th:text="${barco.nombre}"></p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold text-muted">Propietario:</label>
                                        <p class="mb-1">
                                            <i class="fas fa-user me-1"></i>
                                            <a th:href="@{'/jugadores/' + ${barco.jugador.id}}" class="text-decoration-none">
                                                <span th:text="${barco.jugador.nombre}"></span>
                                            </a>
                                            <br>
                                            <small class="text-muted" th:text="${barco.jugador.email}"></small>
                                        </p>
                                    </div>
                                    
                                    <div class="mb-3">
                                        <label class="form-label fw-bold text-muted">Estado:</label>
                                        <p class="mb-1">
                                            <span th:if="${barco.activo}" class="badge bg-success">
                                                <i class="fas fa-check-circle me-1"></i>Activo
                                            </span>
                                            <span th:unless="${barco.activo}" class="badge bg-secondary">
                                                <i class="fas fa-times-circle me-1"></i>Inactivo
                                            </span>
                                        </p>
                                    </div>
                                </div>
                                
                                <!-- Información del modelo -->
                                <div class="col-md-6">
                                    <h5 class="text-primary mb-3">
                                        <i class="fas fa-ship me-2"></i>Modelo del Barco
                                    </h5>
                                    
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">
                                                <a th:href="@{'/modelos/' + ${barco.modelo.id}}" class="text-decoration-none">
                                                    <span th:text="${barco.modelo.nombre}"></span>
                                                </a>
                                            </h6>
                                            <div class="row">
                                                <div class="col-6">
                                                    <small class="text-muted">Eslora:</small><br>
                                                    <strong th:text="${barco.modelo.eslora} + ' m'"></strong>
                                                </div>
                                                <div class="col-6">
                                                    <small class="text-muted">Manga:</small><br>
                                                    <strong th:text="${barco.modelo.manga} + ' m'"></strong>
                                                </div>
                                            </div>
                                            <div class="mt-2">
                                                <small class="text-muted">Velocidad Máxima:</small><br>
                                                <span class="badge bg-info" th:text="${barco.modelo.velocidadMaxima} + ' nudos'"></span>
                                            </div>
                                            <div class="mt-2" th:if="${barco.modelo.descripcion}">
                                                <small class="text-muted">Descripción:</small><br>
                                                <small th:text="${barco.modelo.descripcion}"></small>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Configuración técnica -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <h5 class="text-primary mb-3">
                                        <i class="fas fa-cogs me-2"></i>Configuración Técnica Actual
                                    </h5>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="fas fa-tachometer-alt fa-2x text-info mb-2"></i>
                                            <h6 class="card-title">Velocidad Actual</h6>
                                            <h4 class="text-info" th:text="${barco.velocidadActual} + ' nudos'"></h4>
                                            <small class="text-muted">
                                                Máx: <span th:text="${barco.modelo.velocidadMaxima} + ' nudos'"></span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="fas fa-map-marker-alt fa-2x text-success mb-2"></i>
                                            <h6 class="card-title">Posición X</h6>
                                            <h4 class="text-success" th:text="${barco.posicionX}"></h4>
                                            <small class="text-muted">Coordenada horizontal</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="fas fa-map-marker-alt fa-2x text-warning mb-2"></i>
                                            <h6 class="card-title">Posición Y</h6>
                                            <h4 class="text-warning" th:text="${barco.posicionY}"></h4>
                                            <small class="text-muted">Coordenada vertical</small>
                                        </div>
                                    </div>
                                </div>
                                
                                <div class="col-md-3">
                                    <div class="card text-center">
                                        <div class="card-body">
                                            <i class="fas fa-compass fa-2x text-danger mb-2"></i>
                                            <h6 class="card-title">Dirección</h6>
                                            <h4 class="text-danger" th:text="${barco.direccion} + '°'"></h4>
                                            <small class="text-muted">
                                                <span th:switch="${barco.direccion}">
                                                    <span th:case="0">Norte</span>
                                                    <span th:case="90">Este</span>
                                                    <span th:case="180">Sur</span>
                                                    <span th:case="270">Oeste</span>
                                                    <span th:case="*">
                                                        <span th:if="${barco.direccion > 0 and barco.direccion < 90}">Noreste</span>
                                                        <span th:if="${barco.direccion > 90 and barco.direccion < 180}">Sureste</span>
                                                        <span th:if="${barco.direccion > 180 and barco.direccion < 270}">Suroeste</span>
                                                        <span th:if="${barco.direccion > 270 and barco.direccion < 360}">Noroeste</span>
                                                    </span>
                                                </span>
                                            </small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Mapa de posición visual -->
                            <div class="row mt-4">
                                <div class="col-12">
                                    <h5 class="text-primary mb-3">
                                        <i class="fas fa-map me-2"></i>Posición en el Mapa
                                    </h5>
                                    <div class="card">
                                        <div class="card-body text-center">
                                            <div class="position-relative" style="height: 300px; background: linear-gradient(to bottom, #87CEEB 0%, #4682B4 100%); border-radius: 8px; overflow: hidden;">
                                                <!-- Representación visual simple del barco -->
                                                <div class="position-absolute" 
                                                     th:style="'left: ' + ${(barco.posicionX % 500) / 5} + '%; top: ' + ${(barco.posicionY % 300) / 3} + '%; transform: translate(-50%, -50%) rotate(' + ${barco.direccion} + 'deg);'">
                                                    <i class="fas fa-ship fa-2x text-white" style="text-shadow: 2px 2px 4px rgba(0,0,0,0.5);"></i>
                                                </div>
                                                <!-- Coordenadas -->
                                                <div class="position-absolute bottom-0 start-0 p-2">
                                                    <small class="text-white bg-dark bg-opacity-75 px-2 py-1 rounded">
                                                        <i class="fas fa-crosshairs me-1"></i>
                                                        (<span th:text="${barco.posicionX}"></span>, <span th:text="${barco.posicionY}"></span>)
                                                    </small>
                                                </div>
                                            </div>
                                            <small class="text-muted mt-2 d-block">Representación visual aproximada de la posición del barco</small>
                                        </div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Historial de participaciones (si las hay) -->
                            <div th:if="${barco.participaciones != null and !barco.participaciones.isEmpty()}" class="mt-4">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-trophy me-2"></i>Participaciones en Partidas
                                </h5>
                                <div class="alert alert-info">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Este barco ha participado en <strong th:text="${barco.participaciones.size()}"></strong> partida(s).
                                    <a th:href="@{/partidas(barcoId=${barco.id})}" class="alert-link">Ver historial</a>
                                </div>
                            </div>
                            
                            <div th:unless="${barco.participaciones != null and !barco.participaciones.isEmpty()}" class="mt-4">
                                <h5 class="text-primary mb-3">
                                    <i class="fas fa-trophy me-2"></i>Participaciones en Partidas
                                </h5>
                                <div class="alert alert-secondary">
                                    <i class="fas fa-info-circle me-2"></i>
                                    Este barco no ha participado en ninguna partida aún.
                                </div>
                            </div>
                        </div>
                        
                        <div class="card-footer d-flex justify-content-between">
                            <a th:href="@{/barcos}" class="btn btn-secondary">
                                <i class="fas fa-arrow-left me-1"></i>Volver a la Lista
                            </a>
                            <div class="d-flex gap-2">
                                <a th:href="@{'/barcos/' + ${barco.id} + '/edit'}" class="btn btn-warning">
                                    <i class="fas fa-edit me-1"></i>Editar Barco
                                </a>
                                <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deleteModal">
                                    <i class="fas fa-trash me-1"></i>Eliminar
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Modal de confirmación de eliminación -->
        <div class="modal fade" id="deleteModal" tabindex="-1" aria-labelledby="deleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteModalLabel">
                            <i class="fas fa-exclamation-triangle text-warning me-2"></i>
                            Confirmar Eliminación
                        </h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        <p>¿Estás seguro de que deseas eliminar el barco <strong th:text="${barco.nombre}"></strong>?</p>
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Advertencia:</strong> Esta acción no se puede deshacer. Si el barco tiene participaciones en partidas, también se eliminarán.
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                            <i class="fas fa-times me-1"></i>Cancelar
                        </button>
                        <form th:action="@{'/barcos/' + ${barco.id} + '/delete'}" method="post" style="display: inline;">
                            <button type="submit" class="btn btn-danger">
                                <i class="fas fa-trash me-1"></i>Eliminar
                            </button>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </main>
</body>
</html>