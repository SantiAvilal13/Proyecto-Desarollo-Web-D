<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org" th:replace="~{layout :: layout(~{::title}, ~{::main})}">
<head>
    <title th:text="${barco.id != null ? 'Editar Barco' : 'Nuevo Barco'}">Barco</title>
</head>
<body>
    <main>
        <div class="container mt-4">
            <div class="row justify-content-center">
                <div class="col-md-10">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title mb-0">
                                <i class="fas fa-ship me-2"></i>
                                <span th:text="${barco.id != null ? 'Editar Barco' : 'Nuevo Barco'}"></span>
                            </h3>
                        </div>
                        <div class="card-body">
                            <!-- Mensajes de error -->
                            <div th:if="${errorMessage}" class="alert alert-danger alert-dismissible fade show" role="alert">
                                <i class="fas fa-exclamation-circle me-2"></i>
                                <span th:text="${errorMessage}"></span>
                                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
                            </div>

                            <form th:action="${barco.id != null ? '/barcos/' + barco.id : '/barcos'}" 
                                  th:object="${barco}" 
                                  method="post" 
                                  novalidate>
                                
                                <div class="row">
                                    <!-- Información básica -->
                                    <div class="col-md-6">
                                        <h5 class="text-primary mb-3">
                                            <i class="fas fa-info-circle me-2"></i>Información Básica
                                        </h5>
                                        
                                        <!-- Nombre -->
                                        <div class="mb-3">
                                            <label for="nombre" class="form-label">
                                                <i class="fas fa-tag me-1"></i>Nombre del Barco *
                                            </label>
                                            <input type="text" 
                                                   class="form-control" 
                                                   th:class="${#fields.hasErrors('nombre')} ? 'form-control is-invalid' : 'form-control'"
                                                   id="nombre" 
                                                   th:field="*{nombre}" 
                                                   placeholder="Ej: Viento del Mar"
                                                   required>
                                            <div th:if="${#fields.hasErrors('nombre')}" class="invalid-feedback">
                                                <span th:errors="*{nombre}"></span>
                                            </div>
                                        </div>

                                        <!-- Propietario -->
                                        <div class="mb-3">
                                            <label for="jugador" class="form-label">
                                                <i class="fas fa-user me-1"></i>Propietario *
                                            </label>
                                            <select class="form-select" 
                                                    th:class="${#fields.hasErrors('jugador')} ? 'form-select is-invalid' : 'form-select'"
                                                    id="jugador" 
                                                    th:field="*{jugador}" 
                                                    required>
                                                <option value="">Selecciona un jugador...</option>
                                                <option th:each="jugador : ${jugadores}" 
                                                        th:value="${jugador.id}" 
                                                        th:text="${jugador.nombre + ' (' + jugador.email + ')'}"></option>
                                            </select>
                                            <div th:if="${#fields.hasErrors('jugador')}" class="invalid-feedback">
                                                <span th:errors="*{jugador}"></span>
                                            </div>
                                        </div>

                                        <!-- Modelo -->
                                        <div class="mb-3">
                                            <label for="modelo" class="form-label">
                                                <i class="fas fa-ship me-1"></i>Modelo *
                                            </label>
                                            <select class="form-select" 
                                                    th:class="${#fields.hasErrors('modelo')} ? 'form-select is-invalid' : 'form-select'"
                                                    id="modelo" 
                                                    th:field="*{modelo}" 
                                                    required>
                                                <option value="">Selecciona un modelo...</option>
                                                <option th:each="modelo : ${modelos}" 
                                                        th:value="${modelo.id}" 
                                                        th:text="${modelo.nombre + ' (Vel. máx: ' + modelo.velocidadMaxima + ' nudos)'}"></option>
                                            </select>
                                            <div class="form-text">El modelo determina las características técnicas del barco</div>
                                            <div th:if="${#fields.hasErrors('modelo')}" class="invalid-feedback">
                                                <span th:errors="*{modelo}"></span>
                                            </div>
                                        </div>

                                        <!-- Estado -->
                                        <div class="mb-3">
                                            <div class="form-check">
                                                <input class="form-check-input" 
                                                       type="checkbox" 
                                                       th:field="*{activo}" 
                                                       id="activo">
                                                <label class="form-check-label" for="activo">
                                                    <i class="fas fa-toggle-on me-1"></i>Barco Activo
                                                </label>
                                            </div>
                                            <div class="form-text">Los barcos inactivos no pueden participar en partidas</div>
                                        </div>
                                    </div>
                                    
                                    <!-- Configuración técnica -->
                                    <div class="col-md-6">
                                        <h5 class="text-primary mb-3">
                                            <i class="fas fa-cogs me-2"></i>Configuración Técnica
                                        </h5>
                                        
                                        <!-- Velocidad Actual -->
                                        <div class="mb-3">
                                            <label for="velocidadActual" class="form-label">
                                                <i class="fas fa-tachometer-alt me-1"></i>Velocidad Actual (nudos) *
                                            </label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:class="${#fields.hasErrors('velocidadActual')} ? 'form-control is-invalid' : 'form-control'"
                                                   id="velocidadActual" 
                                                   th:field="*{velocidadActual}" 
                                                   min="0" 
                                                   step="0.1"
                                                   placeholder="Ej: 15.5"
                                                   required>
                                            <div class="form-text">Velocidad actual del barco (debe ser menor o igual a la velocidad máxima del modelo)</div>
                                            <div th:if="${#fields.hasErrors('velocidadActual')}" class="invalid-feedback">
                                                <span th:errors="*{velocidadActual}"></span>
                                            </div>
                                        </div>

                                        <!-- Posición X -->
                                        <div class="mb-3">
                                            <label for="posicionX" class="form-label">
                                                <i class="fas fa-map-marker-alt me-1"></i>Posición X *
                                            </label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:class="${#fields.hasErrors('posicionX')} ? 'form-control is-invalid' : 'form-control'"
                                                   id="posicionX" 
                                                   th:field="*{posicionX}" 
                                                   step="0.1"
                                                   placeholder="Ej: 100.5"
                                                   required>
                                            <div th:if="${#fields.hasErrors('posicionX')}" class="invalid-feedback">
                                                <span th:errors="*{posicionX}"></span>
                                            </div>
                                        </div>

                                        <!-- Posición Y -->
                                        <div class="mb-3">
                                            <label for="posicionY" class="form-label">
                                                <i class="fas fa-map-marker-alt me-1"></i>Posición Y *
                                            </label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:class="${#fields.hasErrors('posicionY')} ? 'form-control is-invalid' : 'form-control'"
                                                   id="posicionY" 
                                                   th:field="*{posicionY}" 
                                                   step="0.1"
                                                   placeholder="Ej: 200.3"
                                                   required>
                                            <div th:if="${#fields.hasErrors('posicionY')}" class="invalid-feedback">
                                                <span th:errors="*{posicionY}"></span>
                                            </div>
                                        </div>

                                        <!-- Dirección -->
                                        <div class="mb-3">
                                            <label for="direccion" class="form-label">
                                                <i class="fas fa-compass me-1"></i>Dirección (grados) *
                                            </label>
                                            <input type="number" 
                                                   class="form-control" 
                                                   th:class="${#fields.hasErrors('direccion')} ? 'form-control is-invalid' : 'form-control'"
                                                   id="direccion" 
                                                   th:field="*{direccion}" 
                                                   min="0" 
                                                   max="359"
                                                   step="1"
                                                   placeholder="Ej: 90"
                                                   required>
                                            <div class="form-text">Dirección en grados (0-359): 0°=Norte, 90°=Este, 180°=Sur, 270°=Oeste</div>
                                            <div th:if="${#fields.hasErrors('direccion')}" class="invalid-feedback">
                                                <span th:errors="*{direccion}"></span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Información del modelo seleccionado -->
                                <div class="mt-4">
                                    <div class="card bg-light">
                                        <div class="card-body">
                                            <h6 class="card-title">
                                                <i class="fas fa-info-circle me-2"></i>Información del Modelo Seleccionado
                                            </h6>
                                            <div id="modeloInfo" class="text-muted">
                                                <p class="mb-0">Selecciona un modelo para ver sus características</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Botones -->
                                <div class="d-flex justify-content-between mt-4">
                                    <a th:href="@{/barcos}" class="btn btn-secondary">
                                        <i class="fas fa-arrow-left me-1"></i>Volver
                                    </a>
                                    <button type="submit" class="btn btn-primary">
                                        <i class="fas fa-save me-1"></i>
                                        <span th:text="${barco.id != null ? 'Actualizar' : 'Registrar'}"></span>
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Script para mostrar información del modelo -->
        <script>
            document.addEventListener('DOMContentLoaded', function() {
                const modeloSelect = document.getElementById('modelo');
                const modeloInfo = document.getElementById('modeloInfo');
                const velocidadInput = document.getElementById('velocidadActual');
                
                // Datos de los modelos (pasados desde el controlador)
                const modelos = /*[[${modelos}]]*/ [];
                
                function updateModeloInfo() {
                    const selectedModeloId = modeloSelect.value;
                    if (selectedModeloId) {
                        const modelo = modelos.find(m => m.id == selectedModeloId);
                        if (modelo) {
                            modeloInfo.innerHTML = `
                                <div class="row">
                                    <div class="col-md-3">
                                        <strong>Eslora:</strong> ${modelo.eslora} m
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Manga:</strong> ${modelo.manga} m
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Vel. Máxima:</strong> ${modelo.velocidadMaxima} nudos
                                    </div>
                                    <div class="col-md-3">
                                        <strong>Descripción:</strong> ${modelo.descripcion || 'N/A'}
                                    </div>
                                </div>
                            `;
                            // Actualizar el máximo de velocidad
                            velocidadInput.max = modelo.velocidadMaxima;
                        }
                    } else {
                        modeloInfo.innerHTML = '<p class="mb-0 text-muted">Selecciona un modelo para ver sus características</p>';
                        velocidadInput.removeAttribute('max');
                    }
                }
                
                modeloSelect.addEventListener('change', updateModeloInfo);
                
                // Inicializar si ya hay un modelo seleccionado
                if (modeloSelect.value) {
                    updateModeloInfo();
                }
            });
        </script>
    </main>
</body>
</html>